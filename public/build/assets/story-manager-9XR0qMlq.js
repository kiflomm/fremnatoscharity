import{r as n,u as pe,j as e,H as ge,a as o}from"./app-BRnJR1Sh.js";import{C as J,a as X,b as Z,c as ee,d as je}from"./card-DnLGfEaO.js";import{B as a}from"./index--9UXWzda.js";import{I as U,L as v}from"./label-NLSWumel.js";import{A as fe,D as ye,a as ve,b as Ne,d as N}from"./app-layout-CwjsvM-V.js";import{D as we,a as be,b as Ce,c as ke,d as Se}from"./dialog-BS_gIOG-.js";import{A as E,a as T,b as L,c as z,d as P,e as $,f as M,g as H}from"./alert-dialog-BmYsLGJH.js";import{T as De}from"./textarea-C-zDAql-.js";import{P as _e}from"./plus-JujPnNOU.js";import{N as Ie}from"./index-IhgRiHsg.js";import{S as Ae}from"./search-Gu_FUPgM.js";import{U as Ue}from"./user-DoVxuRGK.js";import{C as Ee}from"./calendar-KdM7TUxi.js";import{H as Te}from"./heart-Ahs-pyJp.js";import{M as Le}from"./message-square-B1teR5D8.js";import{E as ze}from"./ellipsis-je49CKto.js";import{I as Pe}from"./image-ZKLieW3R.js";import{U as $e,A as se,a as te,V as Me,C as He}from"./video-Ba4u240b.js";import{T as re}from"./trash-2-DPuzknPJ.js";/* empty css            */import"./index-IcuPU4lD.js";import"./avatar-KCNf1HZu.js";import"./index-BiSsiKa2.js";import"./log-out-Bpnl5Z85.js";function xs({mode:Fe,breadcrumbs:le,headTitle:ie,headerTitle:ae,headerSubtitle:ne,listTitle:ce,listDescription:oe,basePath:x,posts:b,totalPosts:de,canCreate:F=!0,canEdit:q=!0,canArchive:O=!0,canDelete:V=!0}){const[me,C]=n.useState(!1),[qe,B]=n.useState(null),[k,p]=n.useState(null),[S,g]=n.useState(null),[D,j]=n.useState(null),[w,ue]=n.useState(""),{data:c,setData:f,processing:_,reset:he,errors:d,clearErrors:xe}=pe({story_title:"",story_description:"",category:""}),[I,u]=n.useState([]),[R,h]=n.useState([]),[Oe,K]=n.useState([]),[Ve,Q]=n.useState([]),[y,m]=n.useState([]),W=n.useMemo(()=>!!(c.story_title?.trim()?.length&&c.story_description?.trim()?.length&&c.category),[c]),Y=n.useMemo(()=>{if(!w.trim())return b;const s=w.toLowerCase();return b.filter(t=>t.title.toLowerCase().includes(s)||t.content.toLowerCase().includes(s)||(t.author?.name||"").toLowerCase().includes(s)||t.category.toLowerCase().includes(s))},[b,w]),A=()=>{C(!1),xe(),he("story_title","story_description","category"),u([]),h([]),m([])},G=s=>`${x}/stories/${s}`;return e.jsxs(fe,{breadcrumbs:le,children:[e.jsx(ge,{title:ie}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-4 sm:p-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:ae}),e.jsx("p",{className:"text-muted-foreground",children:ne})]}),F?e.jsxs(a,{className:"w-full sm:w-auto",onClick:()=>C(!0),children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),"Add story"]}):null]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:e.jsxs(J,{children:[e.jsxs(X,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Z,{className:"text-sm font-medium",children:"Total Stories"}),e.jsx(Ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(ee,{children:[e.jsx("div",{className:"text-2xl font-bold",children:de}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All stories"})]})]})}),e.jsxs(J,{children:[e.jsxs(X,{children:[e.jsx(Z,{children:ce}),e.jsx(je,{children:oe}),e.jsx("div",{className:"flex items-center gap-2 max-sm:flex-col sm:justify-between",children:e.jsxs("div",{className:"relative w-full sm:w-auto",children:[e.jsx(Ae,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(U,{placeholder:"Search by title, content, author, category...",className:"pl-8 w-full sm:w-[300px]",value:w,onChange:s=>ue(s.target.value)})]})})]}),e.jsx(ee,{children:e.jsxs("div",{className:"space-y-4",children:[Y.length===0?e.jsx("div",{className:"text-sm text-muted-foreground p-4 border rounded-md",children:"No stories match your search."}):null,Y.map(s=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between gap-3 p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:"flex items-start gap-4 flex-1",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"font-medium text-lg",children:s.title}),s.archived?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:"Archived"}):null,e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:s.category})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:[(s.excerpt||s.content).slice(0,150),(s.excerpt||s.content).length>150?"...":""]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ue,{className:"mr-1 h-3 w-3"}),s.author?.name||"Unknown"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{className:"mr-1 h-3 w-3"}),s.published_at?new Date(s.published_at).toLocaleDateString():new Date(s.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{className:"mr-1 h-3 w-3"}),s.likes_count??0," likes"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Le,{className:"mr-1 h-3 w-3"}),s.comments_count," comments"]})]})]})}),e.jsxs("div",{className:"flex sm:hidden w-full justify-around",children:[e.jsx(a,{variant:"outline",size:"sm",onClick:()=>o.get(G(s.id)),children:"View"}),q?e.jsx(a,{variant:"outline",size:"sm",onClick:()=>{B(s.id),f({...c,story_title:s.title,story_description:s.content,category:s.category});const t=(s.attachments?.images??[]).slice().sort((r,l)=>r.order-l.order);K(t.map(r=>r.id)),Q(t.map(r=>r.url)),h([]),u([]),m((s.attachments?.videos??[]).slice().sort((r,l)=>r.order-l.order).map(r=>r.embedUrl))},children:"Edit"}):null,O?s.archived?e.jsx(a,{variant:"outline",size:"sm",onClick:()=>j(s.id),children:"Unarchive"}):e.jsx(a,{variant:"outline",size:"sm",onClick:()=>g(s.id),children:"Archive"}):null,V?e.jsx(a,{variant:"destructive",size:"sm",onClick:()=>p(s.id),children:"Delete"}):null]}),e.jsx("div",{className:"hidden sm:block",children:e.jsxs(ye,{children:[e.jsx(ve,{asChild:!0,children:e.jsx(a,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(ze,{className:"h-4 w-4"})})}),e.jsxs(Ne,{align:"end",children:[e.jsx(N,{onClick:()=>o.get(G(s.id)),children:"View Story"}),q?e.jsx(N,{onClick:()=>{B(s.id),f({...c,story_title:s.title,story_description:s.content,category:s.category});const t=(s.attachments?.images??[]).slice().sort((r,l)=>r.order-l.order);K(t.map(r=>r.id)),Q(t.map(r=>r.url)),h([]),u([]),m((s.attachments?.videos??[]).slice().sort((r,l)=>r.order-l.order).map(r=>r.embedUrl))},children:"Edit Story"}):null,O?s.archived?e.jsx(N,{onClick:()=>j(s.id),children:"Unarchive Story"}):e.jsx(N,{onClick:()=>g(s.id),children:"Archive Story"}):null,V?e.jsx(N,{className:"text-red-600",onClick:()=>p(s.id),children:"Delete Story"}):null]})]})})]},s.id))]})})]}),F?e.jsx(we,{open:me,onOpenChange:s=>{s?C(!0):A()},children:e.jsxs(be,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto",children:[e.jsx(Ce,{children:e.jsx(ke,{children:"Add story"})}),e.jsxs("form",{className:"space-y-4",onSubmit:s=>{if(s.preventDefault(),!W)return;const t=new FormData;t.append("story_title",c.story_title),t.append("story_description",c.story_description),t.append("category",c.category),I.forEach(r=>{t.append("images[]",r)}),I.forEach((r,l)=>{t.append("images_order[]",String(l))}),y.forEach(r=>{t.append("videos[]",r)}),y.forEach((r,l)=>{t.append("videos_order[]",String(l))}),o.post(`${x}/stories`,t,{onSuccess:()=>{A(),o.reload({only:["posts","totalPosts"]})}})},children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"story-title",children:"Title"}),e.jsx(U,{id:"story-title",value:c.story_title,onChange:s=>f("story_title",s.target.value),placeholder:"Enter a concise title",required:!0}),d.story_title?e.jsx("p",{className:"text-xs text-red-600",children:d.story_title}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"story-content",children:"Content"}),e.jsx(De,{id:"story-content",value:c.story_description,onChange:s=>f("story_description",s.target.value),placeholder:"Write the story content...",rows:6,required:!0}),d.story_description?e.jsx("p",{className:"text-xs text-red-600",children:d.story_description}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"story-category",children:"Category"}),e.jsxs("select",{id:"story-category",className:"w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",value:c.category,onChange:s=>f("category",s.target.value),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select category"}),e.jsx("option",{value:"elders",children:"elders"}),e.jsx("option",{value:"childrens",children:"childrens"}),e.jsx("option",{value:"disabled",children:"disabled"})]}),d.category?e.jsx("p",{className:"text-xs text-red-600",children:String(d.category)}):null]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(v,{className:"m-0",children:"Images"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Upload one or more images"})]}),e.jsxs("div",{className:"rounded-lg border border-dashed p-4 text-center hover:bg-muted/30 transition cursor-pointer",onClick:()=>{document.getElementById("story-images-input")?.click()},children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-muted-foreground",children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Click to choose files"})]}),e.jsx("input",{id:"story-images-input",type:"file",className:"hidden",accept:"image/*",multiple:!0,onChange:s=>{const t=Array.from(s.target.files||[]);if(t.length===0)return;u(l=>[...l,...t]);const r=t.map(l=>URL.createObjectURL(l));h(l=>[...l,...r])}})]}),R.length>0?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:R.map((s,t)=>e.jsxs("div",{className:"relative group border rounded-lg overflow-hidden",children:[e.jsx("img",{src:s,alt:`preview-${t}`,className:"w-full h-32 object-cover"}),e.jsx("div",{className:"absolute left-2 top-2 text-[10px] font-medium px-1.5 py-0.5 rounded bg-black/60 text-white",children:t+1}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 p-1.5 flex items-center justify-between bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx(a,{type:"button",size:"icon",variant:"secondary",className:"h-7 w-7",onClick:()=>{t<=0||(u(r=>{const l=[...r],[i]=l.splice(t,1);return l.splice(t-1,0,i),l}),h(r=>{const l=[...r],[i]=l.splice(t,1);return l.splice(t-1,0,i),l}))},children:e.jsx(se,{className:"h-3.5 w-3.5"})}),e.jsx(a,{type:"button",size:"icon",variant:"secondary",className:"h-7 w-7",onClick:()=>{t>=I.length-1||(u(r=>{const l=[...r],[i]=l.splice(t,1);return l.splice(t+1,0,i),l}),h(r=>{const l=[...r],[i]=l.splice(t,1);return l.splice(t+1,0,i),l}))},children:e.jsx(te,{className:"h-3.5 w-3.5"})})]}),e.jsx(a,{type:"button",size:"icon",variant:"destructive",className:"h-7 w-7",onClick:()=>{u(r=>r.filter((l,i)=>i!==t)),h(r=>r.filter((l,i)=>i!==t))},children:e.jsx(re,{className:"h-3.5 w-3.5"})})]})]},t))}):null,d.images?e.jsx("p",{className:"text-xs text-red-600",children:String(d.images)}):null]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(v,{className:"m-0",children:"YouTube videos"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Paste one or more URLs"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{placeholder:"https://youtube.com/watch?v=...",onKeyDown:s=>{const t=s.target;if(s.key==="Enter"){s.preventDefault();const r=t.value.trim();r&&(m(l=>[...l,r]),t.value="")}}}),e.jsxs(a,{type:"button",variant:"secondary",onClick:s=>{const t=s.currentTarget.previousSibling;if(t&&"value"in t){const r=t.value.trim();r&&(m(l=>[...l,r]),t.value="")}},children:[e.jsx(He,{className:"h-4 w-4 mr-1"})," Add"]})]}),y.length>0?e.jsx("div",{className:"space-y-2 mt-1",children:y.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2 border rounded-md p-2",children:[e.jsx("div",{className:"text-[10px] font-medium px-1.5 py-0.5 rounded bg-muted",children:t+1}),e.jsx("div",{className:"flex-1 truncate text-sm",title:s,children:s}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(a,{type:"button",size:"icon",variant:"secondary",className:"h-7 w-7",onClick:()=>{t<=0||m(r=>{const l=[...r],[i]=l.splice(t,1);return l.splice(t-1,0,i),l})},children:e.jsx(se,{className:"h-3.5 w-3.5"})}),e.jsx(a,{type:"button",size:"icon",variant:"secondary",className:"h-7 w-7",onClick:()=>{t>=y.length-1||m(r=>{const l=[...r],[i]=l.splice(t,1);return l.splice(t+1,0,i),l})},children:e.jsx(te,{className:"h-3.5 w-3.5"})}),e.jsx(a,{type:"button",size:"icon",variant:"destructive",className:"h-7 w-7",onClick:()=>m(r=>r.filter((l,i)=>i!==t)),children:e.jsx(re,{className:"h-3.5 w-3.5"})})]})]},t))}):null]})]}),e.jsxs(Se,{children:[e.jsx(a,{type:"button",variant:"ghost",onClick:A,disabled:_,children:"Cancel"}),e.jsx(a,{type:"submit",disabled:!W||_,children:_?"Creating...":"Create story"})]})]})]})}):null,e.jsx(E,{open:k!==null,onOpenChange:s=>{s||p(null)},children:e.jsxs(T,{children:[e.jsxs(L,{children:[e.jsx(z,{children:"Delete this story?"}),e.jsx(P,{children:"This action cannot be undone. This will permanently delete the story and its related data."})]}),e.jsxs($,{children:[e.jsx(M,{onClick:()=>p(null),children:"Cancel"}),e.jsx(H,{onClick:()=>{k!==null&&o.delete(`${x}/stories/${k}`,{onSuccess:()=>{p(null),o.reload({only:["posts","totalPosts"]})}})},children:"Delete"})]})]})}),e.jsx(E,{open:S!==null,onOpenChange:s=>{s||g(null)},children:e.jsxs(T,{children:[e.jsxs(L,{children:[e.jsx(z,{children:"Archive this story?"}),e.jsx(P,{children:"This story will be hidden from the public page but will remain visible in the dashboard with an archived label."})]}),e.jsxs($,{children:[e.jsx(M,{onClick:()=>g(null),children:"Cancel"}),e.jsx(H,{onClick:()=>{S!==null&&o.post(`${x}/stories/${S}/archive`,{},{onSuccess:()=>{g(null),o.reload({only:["posts","totalPosts"]})}})},children:"Archive"})]})]})}),e.jsx(E,{open:D!==null,onOpenChange:s=>{s||j(null)},children:e.jsxs(T,{children:[e.jsxs(L,{children:[e.jsx(z,{children:"Unarchive this story?"}),e.jsx(P,{children:"This story will be made visible on the public page again."})]}),e.jsxs($,{children:[e.jsx(M,{onClick:()=>j(null),children:"Cancel"}),e.jsx(H,{onClick:()=>{D!==null&&o.post(`${x}/stories/${D}/unarchive`,{},{onSuccess:()=>{j(null),o.reload({only:["posts","totalPosts"]})}})},children:"Unarchive"})]})]})})]})]})}export{xs as default};
